<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="post-title">Loading...</title>
    <meta id="post-description" name="description" content="">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        .prose h1 { font-size: 2rem; font-weight: bold; margin: 1.5rem 0 1rem 0; }
        .prose h2 { font-size: 1.5rem; font-weight: bold; margin: 1.25rem 0 0.75rem 0; }
        .prose h3 { font-size: 1.25rem; font-weight: bold; margin: 1rem 0 0.5rem 0; }
        .prose p { margin: 1rem 0; line-height: 1.6; }
        .prose ul, .prose ol { margin: 1rem 0; padding-left: 2rem; }
        .prose li { margin: 0.25rem 0; }
        .prose ul li { list-style-type: disc; }
        .prose ol li { list-style-type: decimal; }
        .prose pre { background: #1f2937; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin: 1rem 0; }
        .prose code { background: #374151; padding: 0.25rem 0.5rem; border-radius: 0.25rem; }
        .prose pre code { background: none; padding: 0; }
        .prose blockquote { border-left: 4px solid #6b7280; padding-left: 1rem; margin: 1rem 0; font-style: italic; }
    </style>
</head>
<body class="bg-zinc-950 text-white px-6 py-10 max-w-3xl mx-auto">
    <nav class="mb-8">
        <a href="/pages/blog.shtml" class="text-blue-400 hover:text-blue-300 hover:underline">← Back to Blog</a>
    </nav>
    
    <div id="loading" class="text-center py-8">
        <p class="text-gray-400">Loading post...</p>
    </div>
    
    <div id="post-not-found" class="hidden">
        <h1 class="text-3xl font-bold mb-6 text-red-400">Post Not Found</h1>
        <p class="mb-4">The blog post you're looking for doesn't exist.</p>
        <a href="/pages/blog.shtml" class="text-blue-400 hover:text-blue-300 hover:underline">← Back to Blog</a>
    </div>
 
    <div id="post-not-found-catch" class="hidden">
        <h1 class="text-3xl font-bold mb-6 text-red-400">Post Not Found CATCH</h1>
        <p class="mb-4">The blog post you're looking for doesn't exist.</p>
	<p class="mb-4">This is the CATCH error.</p>
        <a href="/pages/blog.shtml" class="text-blue-400 hover:text-blue-300 hover:underline">← Back to Blog</a>
    </div>

    <article id="post-content" class="hidden">
        <header class="mb-8">
            <h1 id="post-title-display" class="text-4xl font-bold mb-2"></h1>
            <time id="post-date" class="text-gray-400"></time>
        </header>
        
        <div id="post-body" class="prose prose-invert max-w-none">
        </div>
    </article>

    <script>
        // Get the slug from the URL
        const path = window.location.pathname;
        const slug = path.split('/').pop().replace('.html', '');
        
        // Fetch all posts and find the matching one
        fetch("/backend/posts")
            .then(res => res.json())
            .then(posts => {
                // Find the post that matches this slug
                const targetLink = `/posts/${slug}.html`;
                const post = posts.find(p => p.link === targetLink);
                
                document.getElementById('loading').classList.add('hidden');
                
                if (!post) {
                    document.getElementById('post-not-found').classList.remove('hidden');
                    document.title = 'Post Not Found';
                    return;
                }
                
                // Update page title and meta
                document.title = post.title;
                document.getElementById('post-title').textContent = post.title;
                document.getElementById('post-description').setAttribute('content', post.content.substring(0, 150) + '...');
                
                // Format the date
                const date = new Date(post.timestamp || post.date);
                const formattedDate = date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                // Display the post using server-rendered HTML
                document.getElementById('post-title-display').textContent = post.title;
                document.getElementById('post-date').textContent = formattedDate;
                
                // Use the server-rendered HTML if available, otherwise fall back to raw content
                if (post.content_html) {
                    document.getElementById('post-body').innerHTML = post.content_html;
                } else {
                    document.getElementById('post-body').textContent = post.content;
                }
                
                document.getElementById('post-content').classList.remove('hidden');    
            })
            .catch(err => {
                console.error('Failed to load post:', err);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('post-not-found-catch').classList.remove('hidden');
                document.title = 'Error Loading Post';
            });
    </script>
</body>
</html>
